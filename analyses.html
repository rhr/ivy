<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>5. Performing analyses &mdash; ivy 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="ivy 0.1 documentation" href="index.html" />
    <link rel="up" title="User’s Guide" href="using.html" />
    <link rel="next" title="ivy" href="modules.html" />
    <link rel="prev" title="4. Plotting" href="plotting.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="modules.html" title="ivy"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plotting.html" title="4. Plotting"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ivy 0.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="using.html" accesskey="U">User&#8217;s Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="performing-analyses">
<h1>5. Performing analyses<a class="headerlink" href="#performing-analyses" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal"><span class="pre">ivy</span></code> has many tools for performing analyses on trees. Here we will cover
a few analyses you can perform.</p>
<div class="section" id="phylogenetically-independent-contrasts">
<h2>5.1. Phylogenetically Independent Contrasts<a class="headerlink" href="#phylogenetically-independent-contrasts" title="Permalink to this headline">¶</a></h2>
<p>You can perform PICs using <code class="docutils literal"><span class="pre">ivy</span></code>&#8216;s <code class="docutils literal"><span class="pre">PIC</span></code> function. This function takes a
root node and a dictionary mapping node labels to character traits as inputs
and outputs a dictionary mappinginternal nodes to tuples containing ancestral
state, its variance (error), the contrast, and the contrasts&#8217;s variance.</p>
<p>The following example uses a consensus tree from Sarkinen et al. 2013 and
Ziegler et al. unpub. data.</p>
<p>Note: This function requires that the root node have a length that is not none.
Note: this function currently cannot handle polytomies.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">ivy</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">csv</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">r</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;examples/solanaceae_sarkinen2013.newick&quot;</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">polvol</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">stylen</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;examples/pollenvolume_stylelength.csv&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">traits</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span> <span class="o">=</span> <span class="s">&quot;,&quot;</span><span class="p">,</span> <span class="n">quotechar</span> <span class="o">=</span> <span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">traits</span><span class="p">:</span>
                <span class="n">polvol</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s">&quot;Binomial&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s">&quot;PollenVolume&quot;</span><span class="p">])</span>
                <span class="n">stylen</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s">&quot;Binomial&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s">&quot;StyleLength&quot;</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">contrasts</span><span class="o">.</span><span class="n">PIC</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">polvol</span><span class="p">)</span> <span class="c"># Contrasts for log-transformed pollen volume</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">contrasts</span><span class="o">.</span><span class="n">PIC</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">stylen</span><span class="p">)</span> <span class="c"># Contrasts for log-transformed style length</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">pcons</span><span class="p">,</span> <span class="n">scons</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">])</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">scons</span><span class="p">,</span><span class="n">pcons</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="lineages-through-time">
<h2>5.2. Lineages Through Time<a class="headerlink" href="#lineages-through-time" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">ivy</span></code> has functions for computing LTTs. The <code class="docutils literal"><span class="pre">ltt</span></code> function takes a root
node as input and returns a tuple of 1D-arrays containing the results of
times and diverisities.</p>
<p>Note: The tree is expected to be an ultrametric chromogram (extant leaves,
branch lengths proportional to time).</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">ivy</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">r</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;examples/solanaceae_sarkinen2013.newick&quot;</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">v</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">ltt</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</pre></div>
</div>
<p>You can plot your results using <code class="docutils literal"><span class="pre">matplotlib</span></code>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time&quot;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Lineages&quot;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;LTT&quot;</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/ltt.png"><img alt="_images/ltt.png" src="_images/ltt.png" style="width: 700px;" /></a>
</div>
<div class="section" id="phylorate-plot">
<h2>5.3. Phylorate plot<a class="headerlink" href="#phylorate-plot" title="Permalink to this headline">¶</a></h2>
<p>By accessing R libraries using <a class="reference external" href="http://rpy.sourceforge.net/">rpy2</a>, we can use
the functions in the <a class="reference external" href="https://cran.r-project.org/web/packages/BAMMtools/index.html">BAMMtools</a>
R library to generate phylorate plots.</p>
<p>The following analysis is done using the whales dataset provided with BAMMtools.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ivy.r_funcs</span> <span class="kn">import</span> <span class="n">phylorate</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">e</span> <span class="o">=</span> <span class="s">&quot;whaleEvents.csv&quot;</span> <span class="c"># Event data created with BAMM</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">treefile</span> <span class="o">=</span> <span class="s">&quot;whales.tre&quot;</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">rates</span> <span class="o">=</span> <span class="n">phylorate</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">treefile</span><span class="p">,</span> <span class="s">&quot;netdiv&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can add the results as a layer to a plot using the <code class="docutils literal"><span class="pre">add_phylorate</span></code> function
in <code class="docutils literal"><span class="pre">ivy.vis.layers</span></code></p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ivy.vis</span> <span class="kn">import</span> <span class="n">layers</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">r</span> <span class="o">=</span> <span class="n">readtree</span><span class="p">(</span><span class="n">treefile</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">treefig</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">layers</span><span class="o">.</span><span class="n">add_phylorate</span><span class="p">,</span> <span class="n">rates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ov</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
       <span class="n">store</span><span class="o">=</span><span class="s">&quot;netdiv&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/phylorate_plot.png"><img alt="_images/phylorate_plot.png" src="_images/phylorate_plot.png" style="width: 700px;" /></a>
</div>
<div class="section" id="mk-models">
<h2>5.4. Mk models<a class="headerlink" href="#mk-models" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">ivy</span></code> has functions to fit an Mk model given a tree and a list of character
states. There are functions to fit the Mk model using both maximum likelihood
and Bayesian MCMC methods.</p>
<p>To fit an Mk model, you need a tree and a list of character states. This list
should only contain integers 0,1,2,...,N, with each integer corresponding to
a state. The list of characters should be provided in preorder sequence.</p>
<p>Let&#8217;s read in some example data: plant habit in tobacco. We can load in a
csv containing binomials and character states using the <code class="docutils literal"><span class="pre">loadChars</span></code> function.
This gives us a dictionary mapping binomials to character states.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;examples/nicotiana.newick&quot;</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">chars</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">load_chars</span><span class="p">(</span><span class="s">&quot;examples/nicotianaHabit.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Let&#8217;s get our data into the correct format: we need to convert <cite>chars</cite> into
a list of 0&#8217;s and 1&#8217;s matching the character states in preorder sequence</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">charsPreorder</span> <span class="o">=</span> <span class="p">[</span> <span class="n">chars</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">label</span><span class="p">][</span><span class="s">&quot;Habit&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">()</span> <span class="p">]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">charList</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s">&quot;Herb&quot;</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span> <span class="n">charsPreorder</span><span class="p">)</span>
</pre></div>
</div>
<p>We can take a look at how the states are distributed on the tree using the
<code class="docutils literal"><span class="pre">tip_chars</span></code> method on a tree figure object. In this case &#8220;Herb&#8221; will be
represented by green and &#8220;Shrub&#8221; will be represented by brown.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">treevis</span><span class="o">.</span><span class="n">TreeFigure</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">fig</span><span class="o">.</span><span class="n">tip_chars</span><span class="p">(</span><span class="n">charList</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;green&quot;</span><span class="p">,</span> <span class="s">&quot;brown&quot;</span><span class="p">])</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/nicotiana_1.png"><img alt="_images/nicotiana_1.png" src="_images/nicotiana_1.png" style="width: 700px;" /></a>
<p>Now we are ready to fit the model. We will go over the maximum likelihood
approach first.</p>
<div class="section" id="maximum-likelihood">
<h3>5.4.1. Maximum Likelihood<a class="headerlink" href="#maximum-likelihood" title="Permalink to this headline">¶</a></h3>
<p>Perhaps the simplest way to fit an Mk model is with the maximum likelihood
approach. We will make use of the <code class="docutils literal"><span class="pre">optimize</span></code> module of <code class="docutils literal"><span class="pre">scipy</span></code> to find
the maximum likelihood values of this model.</p>
<p>First, we must consider what type of model to fit. <cite>ivy</cite> allows you to
specify what kind of instantaneous rate matrix (Q matrix) to use.
The options are:</p>
<ul class="simple">
<li><strong>&#8220;ER&#8221;</strong>: An equal-rates Q matrix has only one parameter: the forward and
backswards rates for all characters are all equal.</li>
<li><strong>&#8220;Sym&#8221;</strong>: A symmetrical rates Q matrix forces forward and reverse rates
to be equal, but allows rates for different characters to differ. It has
a number of parameters equal to (N^2 - N)/2, where N is the number of
character states.</li>
<li><strong>&#8220;ARD&#8221;</strong>: An all-rates different Q matrix allows all rates to vary freely.
It has a number of parameters equal to (N^2 - N).</li>
</ul>
<p>In this case, we will fit an ARD Q matrix.</p>
<p>We also need to specify how the prior at the root is handled. There are a
few ways to handle weighting the likelihood at the root:</p>
<ul class="simple">
<li><strong>&#8220;Equal&#8221;</strong>: When the likelihood at the root is set to equal, no weighting
is given to the root being in any particular state. All likelihoods
for all states are given equal weighting</li>
<li><strong>&#8220;Equilibrium&#8221;</strong>: This setting causes the likelihoods at the root to be
weighted by the stationary distribution of the Q matrix, as is described
in Maddison et al 2007.</li>
<li><strong>&#8220;Fitzjohn&#8221;</strong>: This setting causes the likelihoods at the root to be
weighted by how well each root state would explain the data at the tips,
as is described in Fitzjohn 2009.</li>
</ul>
<p>In this case we will use the &#8220;Fitzjohn&#8221; method.</p>
<p>We can use the <code class="docutils literal"><span class="pre">fitMk</span></code> method with these settings to fit the model. This
function returns a <code class="docutils literal"><span class="pre">dict</span></code> containing the fitted Q matrix, the log-likelihood,
and the weighting at the root node.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ivy.chars</span> <span class="kn">import</span> <span class="n">mk</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">mk_results</span> <span class="o">=</span> <span class="n">mk</span><span class="o">.</span><span class="n">fit_Mk</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">charList</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="s">&quot;ARD&quot;</span><span class="p">,</span> <span class="n">pi</span><span class="o">=</span><span class="s">&quot;Fitzjohn&quot;</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="k">print</span> <span class="n">mk_results</span><span class="p">[</span><span class="s">&quot;Q&quot;</span><span class="p">]</span>
<span class="p">[[</span><span class="o">-</span><span class="mf">0.01246449</span>  <span class="mf">0.01246449</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.09898439</span> <span class="o">-</span><span class="mf">0.09898439</span><span class="p">]]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="k">print</span> <span class="n">mk_results</span><span class="p">[</span><span class="s">&quot;Log-likelihood&quot;</span><span class="p">]</span>
<span class="o">-</span><span class="mf">11.3009106093</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="k">print</span> <span class="n">mk_results</span><span class="p">[</span><span class="s">&quot;pi&quot;</span><span class="p">]</span>
<span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">0.088591248260230959</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">0.9114087517397691</span><span class="p">}</span>
</pre></div>
</div>
<p>Let&#8217;s take a look at the results</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="k">print</span> <span class="n">mk_results</span><span class="p">[</span><span class="s">&quot;Q&quot;</span><span class="p">]</span>
<span class="p">[[</span><span class="o">-</span><span class="mf">0.01246449</span>  <span class="mf">0.01246449</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.09898439</span> <span class="o">-</span><span class="mf">0.09898439</span><span class="p">]]</span>
</pre></div>
</div>
<p>First is the Q matrix. The fitted Q matrix shows the transition rate from i-&gt;j,
where i is the row and j is the column. Recall that in this dataset, character
0 corresponds to herbacious and 1 to woody. We can see that the transition
rate from woody to herbacious is higher than the transition from
herbacious to woody.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="k">print</span> <span class="n">mk_results</span><span class="p">[</span><span class="s">&quot;Log-likelihood&quot;</span><span class="p">]</span>
<span class="o">-</span><span class="mf">11.3009106093</span>
</pre></div>
</div>
<p>Next is the log-likelihood. This is the log-likelihood of the data using
the fitted model</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="k">print</span> <span class="n">mk_results</span><span class="p">[</span><span class="s">&quot;pi&quot;</span><span class="p">]</span>
<span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">0.088591248260230959</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">0.9114087517397691</span><span class="p">}</span>
</pre></div>
</div>
<p>Finally we have pi, the weighting at the root. We can see that there is
higher weighting for the root being in state 1 (woody).</p>
</div>
<div class="section" id="bayesian">
<h3>5.4.2. Bayesian<a class="headerlink" href="#bayesian" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">ivy</span></code> has a framework in place for using <code class="docutils literal"><span class="pre">pymc</span></code> to sample from a Bayesian
Mk model. The process of fitting a Bayesian Mk model is very similar to fitting
a maximum likelihood model.</p>
<p>The module <code class="docutils literal"><span class="pre">bayesian_models</span></code> has a function <code class="docutils literal"><span class="pre">create_mk_model</span></code> that takes
the same input as <code class="docutils literal"><span class="pre">fitMk</span></code> and creates a <code class="docutils literal"><span class="pre">pymc</span></code> model that can  be sampled
with an MCMC chain</p>
<p>First we create the model.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ivy.chars</span> <span class="kn">import</span> <span class="n">bayesian_models</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ivy.chars.bayesian_models</span> <span class="kn">import</span> <span class="n">create_mk_model</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="n">mk_mod</span> <span class="o">=</span> <span class="n">create_mk_model</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">charList</span><span class="p">,</span> <span class="n">Qtype</span><span class="o">=</span><span class="s">&quot;ARD&quot;</span><span class="p">,</span> <span class="n">pi</span><span class="o">=</span><span class="s">&quot;Fitzjohn&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now that we have the model, we can use <code class="docutils literal"><span class="pre">pymc</span></code> syntax to set up an MCMC chain.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">pymc</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">mk_mcmc</span> <span class="o">=</span> <span class="n">pymc</span><span class="o">.</span><span class="n">MCMC</span><span class="p">(</span><span class="n">mk_mod</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="n">mk_mcmc</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="n">burn</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">thin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">[</span><span class="o">-----------------</span><span class="mi">100</span><span class="o">%-----------------</span><span class="p">]</span> <span class="mi">2000</span> <span class="n">of</span> <span class="mi">2000</span> <span class="n">complete</span> <span class="ow">in</span> <span class="mf">4.7</span> <span class="n">sec</span>
</pre></div>
</div>
<p>We can access the results using the <code class="docutils literal"><span class="pre">trace</span></code> method of the mcmc object and
giving it the name of the parameter we want. In this case, we want &#8220;Qparams&#8221;</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="n">mk_mcmc</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Qparams&quot;</span><span class="p">)[:]</span>
<span class="n">array</span><span class="p">([[</span> <span class="mf">0.01756608</span><span class="p">,</span>  <span class="mf">0.07222648</span><span class="p">],</span>
   <span class="p">[</span> <span class="mf">0.03266443</span><span class="p">,</span>  <span class="mf">0.05712813</span><span class="p">],</span>
   <span class="p">[</span> <span class="mf">0.03266443</span><span class="p">,</span>  <span class="mf">0.05712813</span><span class="p">],</span>
   <span class="o">...</span><span class="p">,</span>
   <span class="p">[</span> <span class="mf">0.01170189</span><span class="p">,</span>  <span class="mf">0.03909211</span><span class="p">],</span>
   <span class="p">[</span> <span class="mf">0.01170189</span><span class="p">,</span>  <span class="mf">0.03909211</span><span class="p">],</span>
   <span class="p">[</span> <span class="mf">0.00989616</span><span class="p">,</span>  <span class="mf">0.03305975</span><span class="p">]])</span>
</pre></div>
</div>
<p>Each element of the trace is an array containing the two fitted Q parameters.
Let&#8217;s get the 5%, 50%, and 95% percentiles for both parameters</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">Q01</span> <span class="o">=</span> <span class="p">[</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mk_mcmc</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Qparams&quot;</span><span class="p">)[:]</span> <span class="p">]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="n">Q10</span> <span class="o">=</span> <span class="p">[</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mk_mcmc</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Qparams&quot;</span><span class="p">)[:]</span> <span class="p">]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">Q01</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">95</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.00308076</span><span class="p">,</span>  <span class="mf">0.01844342</span><span class="p">,</span>  <span class="mf">0.06290078</span><span class="p">])</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">Q10</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">95</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.03294584</span><span class="p">,</span>  <span class="mf">0.09525662</span><span class="p">,</span>  <span class="mf">0.21803742</span><span class="p">])</span>
</pre></div>
</div>
<p>Unsurprisingly, the results are similar to the ones we got from the maximum
likelihood analysis</p>
</div>
</div>
<div class="section" id="hidden-rates-models">
<h2>5.5. Hidden-Rates Models<a class="headerlink" href="#hidden-rates-models" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">ivy</span></code> has functions for fitting hidden-rates Markov models (HRM) (see Beaulieu et
al. 2013), as well as for performing ancestor-state reconstructions and
visualizations of hidden-rates models.</p>
<p>We will demonstrate these functions using an example dataset, fitting a
two-state character with two different hidden rates or &#8220;regimes&#8221;. Let&#8217;s
set up our data.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">ivy</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ivy.chars</span> <span class="kn">import</span> <span class="n">hrm</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">ivy</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;hrm_600tips.newick&quot;</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">57</span><span class="p">]:</span> <span class="n">chars</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="id1">
<h3>5.5.1. Maximum Likelihood<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">ivy</span></code> can fit a maximum likelihood HRM model using the <code class="docutils literal"><span class="pre">fit_hrm</span></code> function.
Here we will explain the options and uses of this function.</p>
<p>Like the Mk functions, <code class="docutils literal"><span class="pre">ivy</span></code>&#8216;s HRM functions take as input a tree and a list
of the characters in preorder sequence. These character states are already in
order.</p>
<p>The simplest way to fit an HRM model is to use the <code class="docutils literal"><span class="pre">fit_hrm</span></code> function. Like
the <code class="docutils literal"><span class="pre">fitMk</span></code> function, there are a few possible models we can fit:</p>
<ul class="simple">
<li><strong>&#8220;Simple&#8221;</strong>: Under the simple model, each regime is equivalent to an
equal-rates Mk model. Transitions between regimes are all constrained to
be equal. This model fits M+1 parameters where M is the number of regimes.</li>
<li><strong>&#8220;ARD&#8221;</strong>: Under this model, all rates are allowed to vary freely. This
model fits (N^2 - N)/(2/M) + (M^2-M)*N parameters, where N is the
number of character states and M is the number of regimes.</li>
</ul>
<p>Here we will fit a <code class="docutils literal"><span class="pre">Simple</span></code> model.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">58</span><span class="p">]:</span> <span class="n">fit</span> <span class="o">=</span> <span class="n">hrm</span><span class="o">.</span><span class="n">fit_hrm</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">chars</span><span class="p">,</span> <span class="n">nregime</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Qtype</span><span class="o">=</span><span class="s">&quot;Simple&quot;</span><span class="p">,</span> <span class="n">pi</span><span class="o">=</span><span class="s">&quot;Equal&quot;</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">59</span><span class="p">]:</span> <span class="n">fit</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">59</span><span class="p">]:</span>
<span class="p">{</span><span class="s">&#39;Log-likelihood&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">204.52351825389133</span><span class="p">,</span>
<span class="s">&#39;Q&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.04596664</span><span class="p">,</span>  <span class="mf">0.03291299</span><span class="p">,</span>  <span class="mf">0.01305365</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.03291299</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04596664</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">,</span>  <span class="mf">0.01305365</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.01305365</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">,</span> <span class="o">-</span><span class="mf">0.44655655</span><span class="p">,</span>  <span class="mf">0.4335029</span> <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>        <span class="p">,</span>  <span class="mf">0.01305365</span><span class="p">,</span>  <span class="mf">0.4335029</span> <span class="p">,</span> <span class="o">-</span><span class="mf">0.44655655</span><span class="p">]]),</span>
<span class="s">&#39;rootLiks&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">})</span>
</pre></div>
</div>
<p>The output of the <code class="docutils literal"><span class="pre">fit_hrm</span></code> function is a dictionary containing the
fitted Q matrix, the log-likelihood, and the prior weighting at the root (all
values are equal in this case because we set pi to be &#8220;Equal&#8221;)</p>
<p>Now that we have our reconstructed Q matrix, we can perform ancestral state
reconstruction. We will use the <code class="docutils literal"><span class="pre">anc_recon_discrete</span></code> function. This
function can handle both single-regime Mk models and multi-regime
HRM models. This functions takes a tree, the character states at the
tips, and the Q matrix to be used in the reconstruction. We will use
our fitted Q matrix as input. We also provide the prior at the root (in
this case, &#8220;Equal&#8221;). Because this is a hidden-rates model, we also provide
the number of regimes (in this case, 2)</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">60</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ivy.chars</span> <span class="kn">import</span> <span class="n">anc_recon</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">61</span><span class="p">]:</span> <span class="n">recon</span> <span class="o">=</span> <span class="n">anc_recon</span><span class="o">.</span><span class="n">anc_recon_discrete</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">chars</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="n">pi</span><span class="o">=</span><span class="s">&quot;Equal&quot;</span><span class="p">,</span> <span class="n">nregime</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>The output of this function is an array containing the likelihoods of each
node being in each state. We can use the output of this function to
visualize the reconstructed states on the tree.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">62</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ivy.interactive</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">63</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ivy.vis.layers</span> <span class="kn">import</span> <span class="n">add_ancrecon_hrm</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">64</span><span class="p">]:</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">treefig</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">65</span><span class="p">]:</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">add_ancrecon_hrm</span><span class="p">,</span> <span class="n">recon</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/hrm_1.png"><img alt="_images/hrm_1.png" src="_images/hrm_1.png" style="width: 700px;" /></a>
<p>Green corresponds to state 0 and blue to state 1. The more saturated colors
correspond to the faster regime and the duller colors to the slower regime.</p>
</div>
</div>
<div class="section" id="bamm-like-mk-model">
<h2>5.6. BAMM-like Mk model<a class="headerlink" href="#bamm-like-mk-model" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">ivy</span></code> has code for fitting a <a class="reference external" href="http://bamm-project.org/index.html">BAMM</a>-like
Mk model (also referred to here as a multi-mk model) to a tree, where different
sections of the tree have distinct Mk models associated with them.</p>
<p>We will demonstrate fitting a two-regime BAMM-like Mk model in a Bayesian
context using pymc</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">66</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">ivy</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">67</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ivy.chars</span> <span class="kn">import</span> <span class="n">mk_mr</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">68</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ivy</span> <span class="kn">import</span> <span class="n">examples</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">69</span><span class="p">]:</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">examples</span><span class="o">.</span><span class="n">simtree_600</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">70</span><span class="p">]:</span> <span class="n">chars</span> <span class="o">=</span> <span class="n">examples</span><span class="o">.</span><span class="n">simchar_600</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">71</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">()],</span><span class="n">chars</span><span class="p">))</span>
</pre></div>
</div>
<p>First, we will use the <code class="docutils literal"><span class="pre">ivy</span></code> function <code class="docutils literal"><span class="pre">mk_multi_bayes</span></code> to create the pymc
obejct. We will specify the model using a special array, the <code class="docutils literal"><span class="pre">qidx</span></code> array. The
<code class="docutils literal"><span class="pre">qidx</span></code> array provides information for fitting parameters into a Q matrix.</p>
<p>The <code class="docutils literal"><span class="pre">qidx</span></code> for a multi-mk model is a two-dimensional numpy array with four
columns. The first column refers to regime, the second column refers to the row index
of the Q matrix, and the third column refers to the column index of the Q matrix.
The fourth row refers to the parameter identity that will be filled into this
location.</p>
<p>TODO: link to mk_multi_bayes documentation</p>
<p>In this case, we will fit a model where there are two equal-rates mk models
somewhere on the tree, each with two different rates. The <code class="docutils literal"><span class="pre">qidx</span></code> will be
as follows:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">72</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">73</span><span class="p">]:</span> <span class="n">qidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                         <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                         <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                         <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">74</span><span class="p">]:</span> <span class="n">my_model</span> <span class="o">=</span> <span class="n">mk_mr</span><span class="o">.</span><span class="n">mk_multi_bayes</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span><span class="n">nregime</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">qidx</span><span class="o">=</span><span class="n">qidx</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we will sample from our model. We will do 100,000 samples with a burn-in
of 10,000 and a thinning factor of 3.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">75</span><span class="p">]</span> <span class="n">my_model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span><span class="n">burn</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">thin</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can look at the output. Seeing the fitted parameters is easy.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">76</span><span class="p">]:</span> <span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">my_model</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Qparam_0&quot;</span><span class="p">)[:]))</span> <span class="c"># Q param 0</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">77</span><span class="p">]:</span> <span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">my_model</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Qparam_1&quot;</span><span class="p">)[:]))</span> <span class="c"># Q param 1</span>
</pre></div>
</div>
<p>Seeing the location of the fitted switchpoints is a little trickier. We can
use the plotting layer <code class="docutils literal"><span class="pre">add_tree_heatmap</span></code> to see where the switchpoint
was reconstructed at.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">78</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ivy.interactive</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">79</span><span class="p">]:</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">treefig</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">80</span><span class="p">]:</span> <span class="n">switchpoint</span> <span class="o">=</span> <span class="n">my_model</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;switch_0&quot;</span><span class="p">)[:]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">81</span><span class="p">]:</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_layer</span><span class="p">(</span><span class="n">ivy</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">add_tree_heatmap</span><span class="p">,</span><span class="n">switchpoint</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/mkmr_1.png"><img alt="_images/mkmr_1.png" src="_images/mkmr_1.png" style="width: 700px;" /></a>
</div>
<div class="section" id="classe">
<h2>5.7. Classe<a class="headerlink" href="#classe" title="Permalink to this headline">¶</a></h2>
<p>The ClaSSE model is implemented in <code class="docutils literal"><span class="pre">ivy</span></code>. Using <code class="docutils literal"><span class="pre">ivy</span></code>&#8216;s ClaSSE implementation,
you can fit ClaSSE, along with all of its derivatives like GeoSSE, to your data.</p>
<p>We will demonstrate fitting a fully-parameterized 2-state ClaSSE model to some
data, then fitting a 3-state ClaSSE model that has been parameterized to be
identical to GeoSSE.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">82</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">ivy</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">83</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ivy.chars.sse</span> <span class="kn">import</span> <span class="n">sse</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">84</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ivy</span> <span class="kn">import</span> <span class="n">examples</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">85</span><span class="p">]:</span> <span class="n">root</span> <span class="o">=</span> <span class="n">examples</span><span class="o">.</span><span class="n">simtree_600</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">86</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="n">examples</span><span class="o">.</span><span class="n">simdata_600</span>
</pre></div>
</div>
<div class="section" id="maximum-likelihood-classe">
<h3>5.7.1. Maximum likelihood ClaSSE<a class="headerlink" href="#maximum-likelihood-classe" title="Permalink to this headline">¶</a></h3>
<p>Fitting a model is relatively straightforward with <code class="docutils literal"><span class="pre">fit_classe</span></code>.
This implementation is reasonably fast but still may take a little while.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">87</span><span class="p">]:</span> <span class="n">mle_classe</span> <span class="o">=</span> <span class="n">sse</span><span class="o">.</span><span class="n">fit_classe</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">88</span><span class="p">]:</span> <span class="k">print</span><span class="p">(</span><span class="n">mle_classe</span><span class="p">[</span><span class="s">&quot;lnl&quot;</span><span class="p">])</span>
<span class="o">-</span><span class="mf">1287.64633207</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">89</span><span class="p">]:</span> <span class="k">print</span><span class="p">(</span><span class="n">mle_classe</span><span class="p">[</span><span class="s">&quot;fit&quot;</span><span class="p">])</span>
<span class="p">{</span><span class="s">&#39;mu&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span>  <span class="mf">1.23669910e-06</span><span class="p">,</span>   <span class="mf">3.76398510e-05</span><span class="p">]),</span>
 <span class="s">&#39;q&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span> <span class="mf">0.</span>        <span class="p">,</span>  <span class="mf">0.05008601</span><span class="p">],</span>
            <span class="p">[</span> <span class="mf">0.08421281</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]]),</span>
 <span class="s">&#39;lambda&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[[</span>  <span class="mf">4.18641344e-01</span><span class="p">,</span>   <span class="mf">1.48737218e-08</span><span class="p">],</span>
                  <span class="p">[</span>  <span class="mf">0.00000000e+00</span><span class="p">,</span>   <span class="mf">4.33500041e-03</span><span class="p">]],</span>

                 <span class="p">[[</span>  <span class="mf">2.98016896e-08</span><span class="p">,</span>   <span class="mf">0.00000000e+00</span><span class="p">],</span>
                  <span class="p">[</span>  <span class="mf">0.00000000e+00</span><span class="p">,</span>   <span class="mf">5.08865803e-01</span><span class="p">]]])}</span>
</pre></div>
</div>
<p>The output is a dictionary containing the maximum log-likelihood and a
dictionary containing the parameters.</p>
<p>The structure of the parameter dictionary is as follows: the dictionary contains
three arrays; &#8220;lambda&#8221;, &#8220;mu&#8221;, and &#8220;q&#8221;.</p>
<p>The lambda array is a three-dimensional array that corresponds to the speciation rates. The first dimension
corresponds to the parent&#8217;s state, the second to the first child&#8217;s state, and
the third to the second child&#8217;s state. Thus, lambda[0,0,1] corresponds
to the speciation rate where the parent is in state 0, the first child is
in state 0, and the second child is in state 1. As in diversitree,
any lambda values where the first child has a higher state than the second
child (e.g. lambda[0,1,0]) is set to 0.</p>
<p>The q array is a two-dimensional array that corresponds to the rates of character change. The first dimension corresponds
to the rootward state and the second dimension corresponds to the tipward state.
q[0,1] corresponds to the transition rate from 0 to 1. The diagonals are set
to zero.</p>
<p>The mu array is a one-dimensional array. It corresponds to the extinction rate
of each state. mu[0] corresponds to the extinction rate of state 0.</p>
</div>
<div class="section" id="maximum-likelihood-geosse">
<h3>5.7.2. Maximum likelihood GeoSSE<a class="headerlink" href="#maximum-likelihood-geosse" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">ivy</span></code>&#8216;s implementation of ClaSSE allows for flexible model specification.
You can extend ClaSSE through the use of the <code class="docutils literal"><span class="pre">pidx</span></code> parameter. Here we will
demonstrate how you can constrain a ClaSSE model in <code class="docutils literal"><span class="pre">ivy</span></code> to be a GeoSSE
model.</p>
<p>The <code class="docutils literal"><span class="pre">pidx</span></code> parameter is a dictionary of arrays. It is similar to the parameter
output of <code class="docutils literal"><span class="pre">fit_classe</span></code>. Each cell of each array corresponds to a parameter of the model.
With the exception of 0, each integer in the array corresponds to a unique
parameter. In this case, both lambda[0,0,1] and lambda[1,1,1] share the integer 1,
meaning they are constrained to be identical. The order of the integers has no meaning;
the parameter denoted by 2 is not enforced to be greater than the parameter denoted
by 1. Any cell that has a 0 in it is constrained to be 0. Any parameters
not used by the model (e.g. lambda[0,1,0] or q[1,1]) are ignored.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">90</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">91</span><span class="p">]:</span> <span class="n">lambdaidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
                               <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
                               <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
                              <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                               <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                               <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
                              <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                               <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                               <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]]])</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">92</span><span class="p">]:</span> <span class="n">muidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">93</span><span class="p">]:</span> <span class="n">qidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
                         <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                         <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">94</span><span class="p">]:</span> <span class="n">pidx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;lambda&quot;</span><span class="p">:</span><span class="n">lambdaidx</span><span class="p">,</span><span class="s">&quot;mu&quot;</span><span class="p">:</span><span class="n">muidx</span><span class="p">,</span><span class="s">&quot;q&quot;</span><span class="p">:</span><span class="n">qidx</span><span class="p">}</span>
</pre></div>
</div>
<p>Now that we have our <code class="docutils literal"><span class="pre">pidx</span></code> array, we can use it in <code class="docutils literal"><span class="pre">fit_classe</span></code>. This
is an optional parameter: if it is not given, the function defaults to a
fully-parameterized &#8220;all-rates-different&#8221; model.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">95</span><span class="p">]:</span> <span class="n">mle_geosse</span> <span class="o">=</span> <span class="n">sse</span><span class="o">.</span><span class="n">fit_classe</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">nstate</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">pidx</span><span class="o">=</span><span class="n">pidx</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-likelihood-function">
<h3>5.7.3. Creating a likelihood function<a class="headerlink" href="#creating-a-likelihood-function" title="Permalink to this headline">¶</a></h3>
<p>If instead of finding the best-fit values for a ClaSSE model, you want
to create a likelihood function to find the likelihood values of parameters
directly, or to use in a Bayesian context, you can use the <code class="docutils literal"><span class="pre">make_classe</span></code>
function.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">96</span><span class="p">]:</span> <span class="n">f</span> <span class="o">=</span> <span class="n">sse</span><span class="o">.</span><span class="n">make_classe</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>

<span class="n">Create</span> <span class="n">a</span> <span class="n">classe</span> <span class="n">likelihood</span> <span class="n">function</span> <span class="n">to</span> <span class="n">be</span> <span class="n">optimized</span> <span class="k">with</span> <span class="n">nlopt</span> <span class="ow">or</span> <span class="n">used</span>
<span class="ow">in</span> <span class="n">a</span> <span class="n">Bayesian</span> <span class="n">analysis</span>
</pre></div>
</div>
<p>Here is a full explanation of the <code class="docutils literal"><span class="pre">fit_classe</span></code> function:</p>
<div class="highlight-python"><div class="highlight"><pre>Args:
    root (Node): Root of tree to perform the analysis on. MUST BE BIFURCATING
    data (dict): Dictionary mapping node tip labels to character states.
      Character states must be represented by ints starting at index 0.
    nstate (int): Number of states. Can be more than the number of
      states indicated by data. Optional, defaults to number of states in data.
    pidx (dict): Dictionary of parameter indices. Each integer in the
      array, with the exception of 0, corresponds to a unique paramter
      in the parameter array that is given to the likelihood function.
      0 indicates that the value for that parameter is 0.0.
      Any indices in the array that are not &quot;legal&quot; (for example, lambda value 010 or
      q value 00) are ignored.

      Optional. If not given, defaults to an &quot;all-rates-different&quot;
      configuration.
      Dictionary items are:
      &quot;lambda&quot;: k x k x k array of indices indicating lambda values.
                The first dimension corresponds to the parent state,
                the second to the first child&#39;s state, and the third
                to the second child&#39;s state.
                Example:
                np.array([[[1,2],
                           [0,3]],
                          [[4,5],
                           [0,6]]])
      &quot;mu&quot;: k-length 1-dimensional array containing mu indices.
            Example:
            np.array([7,8])
      &quot;q&quot;: k x k array of indices indicating q values. The first
           dimension corresponds to the rootward state and the second
           dimension corresponds to the tipward state.
           Examaple:
           np.array([[0,9],
                     [10,0]])
    condition_on_surv (bool): Whether to condition the likelihood on the
      survival of the clades and speciation of subtending clade. See Nee et al. 1994.
    pi (str): Behavior at the root. Defaults to &quot;Equal&quot;. Possible values:
      Equal: Flat prior weighting all states equally
      Fitzjohn: Weight states by relative probability of observing data (Fitzjohn et al 2009)
      Given: Weight by given pi values.
    pi_given (np.array): If pi = &quot;Given&quot;, use this as the weighting at the root.
      Must sum to 1.
    startingvals (np.array): Starting values for the optimization. Optional, defaults to 0.01 for all values.
Returns:
    function: Function that takes an array of parameters as input.
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">5. Performing analyses</a><ul>
<li><a class="reference internal" href="#phylogenetically-independent-contrasts">5.1. Phylogenetically Independent Contrasts</a></li>
<li><a class="reference internal" href="#lineages-through-time">5.2. Lineages Through Time</a></li>
<li><a class="reference internal" href="#phylorate-plot">5.3. Phylorate plot</a></li>
<li><a class="reference internal" href="#mk-models">5.4. Mk models</a><ul>
<li><a class="reference internal" href="#maximum-likelihood">5.4.1. Maximum Likelihood</a></li>
<li><a class="reference internal" href="#bayesian">5.4.2. Bayesian</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hidden-rates-models">5.5. Hidden-Rates Models</a><ul>
<li><a class="reference internal" href="#id1">5.5.1. Maximum Likelihood</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bamm-like-mk-model">5.6. BAMM-like Mk model</a></li>
<li><a class="reference internal" href="#classe">5.7. Classe</a><ul>
<li><a class="reference internal" href="#maximum-likelihood-classe">5.7.1. Maximum likelihood ClaSSE</a></li>
<li><a class="reference internal" href="#maximum-likelihood-geosse">5.7.2. Maximum likelihood GeoSSE</a></li>
<li><a class="reference internal" href="#creating-a-likelihood-function">5.7.3. Creating a likelihood function</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="plotting.html"
                        title="previous chapter">4. Plotting</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="modules.html"
                        title="next chapter">ivy</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/analyses.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="modules.html" title="ivy"
             >next</a> |</li>
        <li class="right" >
          <a href="plotting.html" title="4. Plotting"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ivy 0.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="using.html" >User&#8217;s Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, RR, CZ.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>